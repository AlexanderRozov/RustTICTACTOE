<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–®–∞—à–∫–∏ –ø–æ —Å–µ—Ç–∏ - P2P –∏–≥—Ä–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .game-container {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 30px;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .board-section {
            text-align: center;
        }

        .checkers-board {
            display: inline-grid;
            grid-template-columns: repeat(8, 60px);
            grid-template-rows: repeat(8, 60px);
            border: 3px solid #8B4513;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .cell {
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .cell.white {
            background-color: #F5DEB3;
        }

        .cell.black {
            background-color: #8B4513;
        }

        .cell.selected {
            background-color: #FFD700 !important;
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.7);
        }

        .cell.valid-move {
            background-color: #90EE90 !important;
            cursor: pointer;
        }

        .cell.valid-move:hover {
            background-color: #32CD32 !important;
            transform: scale(1.05);
        }

        .checker {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: grab;
            transition: all 0.2s ease;
            box-shadow: 0 3px 10px rgba(0,0,0,0.3);
        }

        .checker.white {
            background: radial-gradient(circle, #fff 30%, #ddd 70%);
            border: 2px solid #ccc;
        }

        .checker.black {
            background: radial-gradient(circle, #333 30%, #000 70%);
            border: 2px solid #666;
        }

        .checker.king::after {
            content: "üëë";
            position: absolute;
            top: -5px;
            right: -5px;
            font-size: 1rem;
        }

        .network-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
        }

        .network-section h3 {
            margin-bottom: 20px;
            color: #495057;
            border-bottom: 2px solid #dee2e6;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #495057;
        }

        .form-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #dee2e6;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.2s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s ease;
            width: 100%;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn.secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        }

        .btn.danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }

        .status {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 600;
            text-align: center;
        }

        .status.connected {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.connecting {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .status.disconnected {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .players-list {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .player-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #dee2e6;
        }

        .player-item:last-child {
            border-bottom: none;
        }

        .player-name {
            font-weight: 600;
        }

        .player-host {
            background: #28a745;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
        }

        .chat-section {
            margin-top: 20px;
        }

        .chat-messages {
            height: 200px;
            overflow-y: auto;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 10px;
        }

        .chat-message {
            margin-bottom: 8px;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 5px;
            border-left: 3px solid #667eea;
        }

        .chat-message .player-name {
            font-weight: 600;
            color: #667eea;
            margin-bottom: 5px;
        }

        .chat-message .message-text {
            color: #495057;
        }

        .chat-input {
            display: flex;
            gap: 10px;
        }

        .chat-input input {
            flex: 1;
        }

        .game-info {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: #e9ecef;
            border-radius: 8px;
        }

        .current-player {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .game-status {
            font-size: 1rem;
            color: #6c757d;
        }

        @media (max-width: 768px) {
            .game-container {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .checkers-board {
                grid-template-columns: repeat(8, 40px);
                grid-template-rows: repeat(8, 40px);
            }

            .cell {
                width: 40px;
                height: 40px;
                font-size: 1.5rem;
            }

            .checker {
                width: 35px;
                height: 35px;
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéÆ –®–∞—à–∫–∏ –ø–æ —Å–µ—Ç–∏</h1>
            <p>–ò–≥—Ä–∞–π—Ç–µ –≤ —à–∞—à–∫–∏ —Å –¥—Ä—É–∑—å—è–º–∏ —á–µ—Ä–µ–∑ P2P —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ</p>
        </div>

        <div class="game-container">
            <div class="board-section">
                <div class="game-info">
                    <div class="current-player" id="current-player">–û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...</div>
                    <div class="game-status" id="game-status">–ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –∏–≥—Ä–µ –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é</div>
                </div>

                <div class="checkers-board" id="checkers-board">
                    <!-- –î–æ—Å–∫–∞ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ JavaScript -->
                </div>

                <div style="margin-top: 20px;">
                    <button class="btn" id="new-game-btn">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
                    <button class="btn secondary" id="reset-game-btn">–°–±—Ä–æ—Å–∏—Ç—å</button>
                </div>
            </div>

            <div class="network-section">
                <h3>üåê –°–µ—Ç–µ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</h3>
                
                <div class="status disconnected" id="connection-status">
                    –ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω
                </div>

                <div class="form-group">
                    <label for="player-name">–í–∞—à–µ –∏–º—è:</label>
                    <input type="text" id="player-name" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è" value="–ò–≥—Ä–æ–∫">
                </div>

                <div class="form-group">
                    <label for="game-id">ID –∏–≥—Ä—ã:</label>
                    <input type="text" id="game-id" placeholder="ID –∏–≥—Ä—ã –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è">
                </div>

                <button class="btn" id="create-game-btn">–°–æ–∑–¥–∞—Ç—å –∏–≥—Ä—É</button>
                <button class="btn secondary" id="join-game-btn">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</button>
                <button class="btn danger" id="disconnect-btn" disabled>–û—Ç–∫–ª—é—á–∏—Ç—å—Å—è</button>

                <div class="players-list">
                    <h4>üë• –ò–≥—Ä–æ–∫–∏</h4>
                    <div id="players-list">
                        <div class="player-item">
                            <span>–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤</span>
                        </div>
                    </div>
                </div>

                <div class="chat-section">
                    <h4>üí¨ –ß–∞—Ç</h4>
                    <div class="chat-messages" id="chat-messages">
                        <div class="chat-message">
                            <div class="message-text">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∏–≥—Ä—É! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —á–∞—Ç –¥–ª—è –æ–±—â–µ–Ω–∏—è —Å —Å–æ–ø–µ—Ä–Ω–∏–∫–æ–º.</div>
                        </div>
                    </div>
                    <div class="chat-input">
                        <input type="text" id="chat-input" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." disabled>
                        <button class="btn" id="send-chat-btn" disabled>–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import init, { NetworkGameManager } from './pkg/rust_tic_tac_toe.js';

        let gameManager;
        let currentGame = null;
        let selectedCell = null;
        let validMoves = [];

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        async function initGame() {
            try {
                await init();
                console.log('WASM –º–æ–¥—É–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω');
                
                // –°–æ–∑–¥–∞–µ–º –º–µ–Ω–µ–¥–∂–µ—Ä —Å–µ—Ç–µ–≤–æ–π –∏–≥—Ä—ã
                const playerName = document.getElementById('player-name').value;
                gameManager = new NetworkGameManager(playerName);
                
                // –°–æ–∑–¥–∞–µ–º –¥–æ—Å–∫—É
                createBoard();
                
                // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
                setupEventHandlers();
                
                console.log('–ò–≥—Ä–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–≤–æ–π –¥–æ—Å–∫–∏
        function createBoard() {
            const board = document.getElementById('checkers-board');
            board.innerHTML = '';

            for (let row = 0; row < 8; row++) {
                for (let col = 0; col < 8; col++) {
                    const cell = document.createElement('div');
                    cell.className = `cell ${(row + col) % 2 === 0 ? 'white' : 'black'}`;
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º —à–∞—à–∫–∏ –≤ –Ω–∞—á–∞–ª—å–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏
                    if ((row + col) % 2 === 1) { // –¢–æ–ª—å–∫–æ –Ω–∞ —á–µ—Ä–Ω—ã—Ö –∫–ª–µ—Ç–∫–∞—Ö
                        if (row < 3) {
                            // –ë–µ–ª—ã–µ —à–∞—à–∫–∏
                            const checker = createChecker('white', false);
                            cell.appendChild(checker);
                        } else if (row > 4) {
                            // –ß–µ—Ä–Ω—ã–µ —à–∞—à–∫–∏
                            const checker = createChecker('black', false);
                            cell.appendChild(checker);
                        }
                    }
                    
                    cell.addEventListener('click', () => handleCellClick(row, col));
                    board.appendChild(cell);
                }
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —à–∞—à–∫–∏
        function createChecker(color, isKing) {
            const checker = document.createElement('div');
            checker.className = `checker ${color} ${isKing ? 'king' : ''}`;
            checker.textContent = color === 'white' ? '‚ö™' : '‚ö´';
            return checker;
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ –∫–ª–µ—Ç–∫–µ
        function handleCellClick(row, col) {
            if (!gameManager || !gameManager.isConnected()) {
                alert('–°–Ω–∞—á–∞–ª–∞ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –∏–≥—Ä–µ!');
                return;
            }

            const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
            
            if (selectedCell) {
                // –ï—Å–ª–∏ –∫–ª–µ—Ç–∫–∞ —É–∂–µ –≤—ã–±—Ä–∞–Ω–∞, –ø—ã—Ç–∞–µ–º—Å—è —Å–¥–µ–ª–∞—Ç—å —Ö–æ–¥
                if (isValidMove(selectedCell, { row, col })) {
                    makeMove(selectedCell, { row, col });
                    clearSelection();
                } else {
                    // –í—ã–±–∏—Ä–∞–µ–º –Ω–æ–≤—É—é –∫–ª–µ—Ç–∫—É
                    selectCell(row, col);
                }
            } else {
                // –í—ã–±–∏—Ä–∞–µ–º –∫–ª–µ—Ç–∫—É
                selectCell(row, col);
            }
        }

        // –í—ã–±–æ—Ä –∫–ª–µ—Ç–∫–∏
        function selectCell(row, col) {
            clearSelection();
            
            const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
            if (cell && cell.querySelector('.checker')) {
                cell.classList.add('selected');
                selectedCell = { row, col };
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–µ —Ö–æ–¥—ã
                showValidMoves(row, col);
            }
        }

        // –û—á–∏—Å—Ç–∫–∞ –≤—ã–±–æ—Ä–∞
        function clearSelection() {
            if (selectedCell) {
                const cell = document.querySelector(`[data-row="${selectedCell.row}"][data-col="${selectedCell.col}"]`);
                if (cell) {
                    cell.classList.remove('selected');
                }
                selectedCell = null;
            }
            
            // –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ö–æ–¥–æ–≤
            clearValidMoves();
        }

        // –ü–æ–∫–∞–∑ –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ö–æ–¥–æ–≤
        function showValidMoves(row, col) {
            // –í —Ä–µ–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ö–æ–¥–æ–≤
            // –ü–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ—Å–µ–¥–Ω–∏–µ –∫–ª–µ—Ç–∫–∏
            const directions = [
                { dr: -1, dc: -1 }, { dr: -1, dc: 1 }, // –î–ª—è –±–µ–ª—ã—Ö
                { dr: 1, dc: -1 }, { dr: 1, dc: 1 }    // –î–ª—è —á–µ—Ä–Ω—ã—Ö
            ];
            
            directions.forEach(dir => {
                const newRow = row + dir.dr;
                const newCol = col + dir.dc;
                
                if (newRow >= 0 && newRow < 8 && newCol >= 0 && newCol < 8) {
                    const cell = document.querySelector(`[data-row="${newRow}"][data-col="${newCol}"]`);
                    if (cell && !cell.querySelector('.checker')) {
                        cell.classList.add('valid-move');
                        validMoves.push({ row: newRow, col: newCol });
                    }
                }
            });
        }

        // –û—á–∏—Å—Ç–∫–∞ –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ö–æ–¥–æ–≤
        function clearValidMoves() {
            validMoves.forEach(move => {
                const cell = document.querySelector(`[data-row="${move.row}"][data-col="${move.col}"]`);
                if (cell) {
                    cell.classList.remove('valid-move');
                }
            });
            validMoves = [];
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ —Ö–æ–¥–∞
        function isValidMove(from, to) {
            return validMoves.some(move => move.row === to.row && move.col === to.col);
        }

        // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ö–æ–¥–∞
        function makeMove(from, to) {
            // –í —Ä–µ–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ö–æ–¥–∞ —á–µ—Ä–µ–∑ —Å–µ—Ç—å
            console.log(`–•–æ–¥ —Å ${from.row},${from.col} –Ω–∞ ${to.row},${to.col}`);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å–∫—É
            const fromCell = document.querySelector(`[data-row="${from.row}"][data-col="${from.col}"]`);
            const toCell = document.querySelector(`[data-row="${to.row}"][data-col="${to.col}"]`);
            
            if (fromCell && toCell) {
                const checker = fromCell.querySelector('.checker');
                if (checker) {
                    fromCell.removeChild(checker);
                    toCell.appendChild(checker);
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –≤ –¥–∞–º–∫—É
                    if ((to.row === 0 && checker.classList.contains('white')) ||
                        (to.row === 7 && checker.classList.contains('black'))) {
                        checker.classList.add('king');
                    }
                }
            }
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ö–æ–¥ —á–µ—Ä–µ–∑ —Å–µ—Ç—å
            if (gameManager) {
                try {
                    gameManager.sendMove(from, to);
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ö–æ–¥–∞:', error);
                }
            }
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function setupEventHandlers() {
            // –°–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä—ã
            document.getElementById('create-game-btn').addEventListener('click', () => {
                if (gameManager) {
                    try {
                        gameManager.createGame();
                        updateConnectionStatus('connecting');
                        updateGameId(gameManager.getGameId());
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∏–≥—Ä—ã:', error);
                        alert('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∏–≥—Ä—ã: ' + error);
                    }
                }
            });

            // –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –∏–≥—Ä–µ
            document.getElementById('join-game-btn').addEventListener('click', () => {
                const gameId = document.getElementById('game-id').value.trim();
                if (!gameId) {
                    alert('–í–≤–µ–¥–∏—Ç–µ ID –∏–≥—Ä—ã!');
                    return;
                }
                
                if (gameManager) {
                    try {
                        gameManager.joinGame(gameId);
                        updateConnectionStatus('connecting');
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫ –∏–≥—Ä–µ:', error);
                        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫ –∏–≥—Ä–µ: ' + error);
                    }
                }
            });

            // –û—Ç–∫–ª—é—á–µ–Ω–∏–µ
            document.getElementById('disconnect-btn').addEventListener('click', () => {
                if (gameManager) {
                    try {
                        gameManager.disconnect();
                        updateConnectionStatus('disconnected');
                        clearGame();
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è:', error);
                    }
                }
            });

            // –ù–æ–≤–∞—è –∏–≥—Ä–∞
            document.getElementById('new-game-btn').addEventListener('click', () => {
                if (gameManager && gameManager.isConnected()) {
                    try {
                        gameManager.requestNewGame();
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–æ–≤–æ–π –∏–≥—Ä—ã:', error);
                    }
                } else {
                    createBoard();
                }
            });

            // –°–±—Ä–æ—Å –∏–≥—Ä—ã
            document.getElementById('reset-game-btn').addEventListener('click', () => {
                createBoard();
                clearSelection();
            });

            // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç
            document.getElementById('send-chat-btn').addEventListener('click', sendChatMessage);
            document.getElementById('chat-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendChatMessage();
                }
            });

            // –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –∏–≥—Ä–æ–∫–∞
            document.getElementById('player-name').addEventListener('input', (e) => {
                if (gameManager) {
                    gameManager.setPlayerName(e.target.value);
                }
            });
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç
        function sendChatMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            
            if (message && gameManager) {
                try {
                    gameManager.sendChatMessage(message);
                    addChatMessage('–í—ã', message);
                    input.value = '';
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:', error);
                }
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç
        function addChatMessage(playerName, message) {
            const chatMessages = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message';
            messageDiv.innerHTML = `
                <div class="player-name">${playerName}</div>
                <div class="message-text">${message}</div>
            `;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        function updateConnectionStatus(status) {
            const statusElement = document.getElementById('connection-status');
            statusElement.className = `status ${status}`;
            
            switch (status) {
                case 'connected':
                    statusElement.textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω';
                    document.getElementById('disconnect-btn').disabled = false;
                    document.getElementById('chat-input').disabled = false;
                    document.getElementById('send-chat-btn').disabled = false;
                    break;
                case 'connecting':
                    statusElement.textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...';
                    break;
                case 'disconnected':
                    statusElement.textContent = '–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω';
                    document.getElementById('disconnect-btn').disabled = true;
                    document.getElementById('chat-input').disabled = true;
                    document.getElementById('send-chat-btn').disabled = true;
                    break;
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ID –∏–≥—Ä—ã
        function updateGameId(gameId) {
            document.getElementById('game-id').value = gameId;
        }

        // –û—á–∏—Å—Ç–∫–∞ –∏–≥—Ä—ã
        function clearGame() {
            clearSelection();
            document.getElementById('current-player').textContent = '–û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...';
            document.getElementById('game-status').textContent = '–ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –∏–≥—Ä–µ –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é';
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∏–≥—Ä–æ–∫–æ–≤
        function updatePlayersList(players) {
            const playersList = document.getElementById('players-list');
            playersList.innerHTML = '';
            
            if (players.length === 0) {
                playersList.innerHTML = '<div class="player-item"><span>–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤</span></div>';
                return;
            }
            
            players.forEach(player => {
                const playerItem = document.createElement('div');
                playerItem.className = 'player-item';
                playerItem.innerHTML = `
                    <span class="player-name">${player.name}</span>
                    ${player.isHost ? '<span class="player-host">–•–æ—Å—Ç</span>' : ''}
                `;
                playersList.appendChild(playerItem);
            });
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', initGame);

        // –≠–∫—Å–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è WASM
        window.gameFunctions = {
            updateConnectionStatus,
            updatePlayersList,
            addChatMessage,
            updateGameId
        };
    </script>
</body>
</html>
